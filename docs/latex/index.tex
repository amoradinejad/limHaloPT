\label{index_md_README}%
\Hypertarget{index_md_README}%
\href{https://doi.org/10.21105/joss.04173}{\texttt{ }} \href{https://doi.org/10.5281/zenodo.6762607}{\texttt{ }}

Author\+: Azadeh Moradinezhad Dizgah ~\newline


with contributions from Alberto Vallinotto and Farnik Nikakhtar

Welcom to lim\+Halo\+PT, a peer-\/reviewed open source numerical package for computing the clustering and shot-\/noise contributions to the power spectrum of line intensity/temperature fluctuations within halo-\/model framework. The current version of the code, is limited to real-\/space, and redshift-\/space distortions will be included in the next release.

The extended halo model of line intensity power spectrum implemented in lim\+Halo\+PT, combines the predictions of EFTof\+LSS for halo power spectrum with the standard halo model to account for the nonlinear evolution of matter fluctuations and the nonlinear biasing relation between line intensity fluctuations and the underlying dark matter distribution in 2-\/halo term. Furthermore, the model includes the effect of large bulk velocities (Infrared Resummation) in the 2-\/halo term. The deviations from Poisson shot noise on large scales are also computed within the halo model.

This package is released together with the following publication, \href{https://iopscience.iop.org/article/10.1088/1475-7516/2022/02/026}{\texttt{ JCAP02(2022)026}}, where the predictions of the model are tested against a new suite of simulated intensity (brightness temperature) maps of CO and \mbox{[}CII\mbox{]} lines.\+ \+The mesheded fields from Mithra\+LIMSims will be publically avilable on \href{http://cyril.astro.berkeley.edu/MithraLIMSims}{\texttt{ Mithra\+LIMSims}}. The code to analyse the simulated maps is an extension of the toolkit used in analysing Hidden-\/\+Valley simulations, and is publically avilable on \href{https://github.com/farnikn/MithraLIMSims}{\texttt{ LIM Analysis}}. As discussed in the manuscript above, the packages to compute the theory predictions and creating the simulated intensity maps can be straightforwardly extended to compute the power spectrum signal of other emission lines (emitted from star-\/froming galaxies), beside CO and \mbox{[}CII\mbox{]}.

The source code of this package is publically avaialbel on Git\+Hub at \href{https://github.com/amoradinejad/limHaloPT}{\texttt{ lim\+Halo\+PT}}. The peer-\/reviewed JOSS software publication can be accessed at \href{https://joss.theoj.org/papers/10.21105/joss.04173}{\texttt{ JOSS\+\_\+lim\+Halo\+PT}}. ~\newline
 ~\hypertarget{index_autotoc_md3}{}\doxysubsubsection{Dependencies}\label{index_autotoc_md3}
The lim\+Halo\+PT package calls various functions from \href{https://github.com/lesgourg/class_public}{\texttt{ CLASS}} Boltzman solver, including the matter power spectrum and transfer functions, growth factor etc. Therefore, you need to first download and compile CLASS code, and place the \char`\"{}libclass.\+a\char`\"{} in Class/lib folder. Furtehrmore, the loop calculations are performed with direct numerical integration, using routines of \href{http://www.feynarts.de/cuba/}{\texttt{ CUBA}} library. Lastly, the code heavily uses functions of \href{https://www.gnu.org/software/gsl/doc/html/}{\texttt{ GSL}} scientific library. Therfore, make sure that the two libraries are correctly linked to lim\+Halo\+PT by making necassary modifcations to the makefile (placed in Source directory) of lim\+Halo\+PT package.

Note that in order to compute the luminosities of spectral lines, a model of star formation rate as a function of halo mass and redshift, SFR(\+M\+\_\+h,z), should be assumed. Currently, the implemented model uses SFR(\+M\+\_\+h,z) from \href{https://arxiv.org/abs/1207.6105}{\texttt{ Behroozi et al. (2013)}}. The necassary input file, \char`\"{}sfr\+\_\+release.\+dat\char`\"{}, is included in \char`\"{}\+Input/release-\/sfh\+\_\+z0\+\_\+z8\+\_\+052913/sfr/\char`\"{} subdirectory. ~\newline
 ~\hypertarget{index_autotoc_md4}{}\doxysubsubsection{Structure of the package}\label{index_autotoc_md4}
lim\+Halo\+PT consists of 10 main modules, which include the following categories of functions\+:
\begin{DoxyItemize}
\item {\bfseries{\mbox{\hyperlink{main_8c}{main.\+c}}\+:}} This is the most external module, from which any function that you need is called. Depending on what quantities you want to calculate, you can modify the \mbox{\hyperlink{main_8c_a0ddf1224851353fc92bfbff6f499fa97}{main()}} function in \mbox{\hyperlink{main_8c}{main.\+c}} module (as marked in the code). Two example calls to functions which compute the clustering and shot noise contributions is included in \mbox{\hyperlink{main_8c}{main.\+c}} module. After adding the function calls in this module, you need to re-\/compile the code and then run it. Further details of the modules and descriptions of the functions can be found in documentation of the code.
\item {\bfseries{\mbox{\hyperlink{ps__line__hm_8c}{ps\+\_\+line\+\_\+hm.\+c}}\+:}} This module includes various functions that are needed for computation of halo-\/model line power spectrum, including clustering and stochastic contributions beyond Poisson limit. At the moment, the redshift-\/space distrotions is not included in the halo model implementation.
\item {\bfseries{\mbox{\hyperlink{ps__line__pt_8c}{ps\+\_\+line\+\_\+pt.\+c}}\+:}} This module includes various functions to compute the Poisson shot-\/noise and linear clustering components of line power spectrum, contributions of line interloper to the power spectrum signal. Both real and redshift-\/space linear power spectra are available.
\item {\bfseries{\mbox{\hyperlink{line__ingredients_8c}{line\+\_\+ingredients.\+c}}\+:}} This module includes all the necassary functions to compute the line power spectrum by the above two modules. Many of the functions in this module can be used to develope the extensions of lim\+Halo\+PT to other line statistics beyond the power spectrum.
\item {\bfseries{\mbox{\hyperlink{ps__halo__1loop_8c}{ps\+\_\+halo\+\_\+1loop.\+c}}\+:}} This module includes the ingredients to compute the real-\/space 1loop contributions of the halo/galaxy power spectrum. Both loops due to gravitational evolution and primordial non-\/\+Gaussianity can be calculated. The computations of the loop integrals is performed with direct numerical integration routines from CUBA library.
\item {\bfseries{\mbox{\hyperlink{ir__res_8c}{ir\+\_\+res.\+c}}\+:}} This module includes functions to compute IR-\/resummed matter power spectrum at leading and next-\/to-\/leading order.
\item {\bfseries{\mbox{\hyperlink{wnw__split_8c}{wnw\+\_\+split.\+c}}\+:}} This module includes function to perform the splitting of matter power spectrum into its broadband and wiggle (BAO) contributions.
\item {\bfseries{\mbox{\hyperlink{survey__specs_8c}{survey\+\_\+specs.\+c}}\+:}} This module includes functions to calculate quantities related to the choices of maximum and minnimum scales that can be probed by a given survey.
\item {\bfseries{\mbox{\hyperlink{cosmology_8c}{cosmology.\+c}}\+:}} This module includes function to compute the cosmological quantities at the level of background and perturbations.
\item {\bfseries{\mbox{\hyperlink{read__input_8c}{read\+\_\+input.\+c}}\+:}} This module contains two functions \mbox{\hyperlink{setup__teardown_8c_a688d06a821dead1a3c04bc3a3493acf1}{initialize()}} and clean() which are the first and last functions called by the \mbox{\hyperlink{main_8c_a0ddf1224851353fc92bfbff6f499fa97}{main()}} function. Initialize() reads in the input values from an .ini files.
\item {\bfseries{\mbox{\hyperlink{setup__teardown_8c}{setup\+\_\+teardown.\+c}}\+:}} This module contains utility functions to read in an .ini file.
\item {\bfseries{\mbox{\hyperlink{utilities_8c}{utilities.\+c}}\+:}} This module contains some utility functions, for example to build a dynamically allocated 1-\/dimensional array. These utility functions are used by the rest of the modules. ~\newline

\end{DoxyItemize}\hypertarget{index_autotoc_md5}{}\doxysubsubsection{Compilation}\label{index_autotoc_md5}

\begin{DoxyItemize}
\item To compile, within the main directory of lim\+Halo\+PT, type\+: \char`\"{}make\char`\"{} ~\newline
 This would create an executable called \char`\"{}lim\+Halo\+PT\char`\"{} in the same directory, which you will use to run the code. If you modified the code, you need to first do \char`\"{}make clean\char`\"{} before doing \char`\"{}make\char`\"{}. When the code is compiled, a static library \char`\"{}liblim\+Halo\+PT.\+a\char`\"{} is created and placed in \char`\"{}lib\char`\"{} directory of lim\+Halo\+PT. If you would like to use any of the functions of lim\+Halo\+PT, you can link to this \char`\"{}.\+a\char`\"{} file as an external library.
\end{DoxyItemize}

The entire lim\+Halo\+PT package was developed, compiled, and tested on Mac OS X, using gcc version 7.\+5.\+0 compiler. ~\newline
 ~\hypertarget{index_autotoc_md6}{}\doxysubsubsection{Basic usage}\label{index_autotoc_md6}

\begin{DoxyItemize}
\item To run the code, in the main directory of lim\+Halo\+PT, type \char`\"{}./lim\+Halo\+PT LCDM.\+ini\char`\"{} ~\newline

\end{DoxyItemize}

Currently, the main output of lim\+Halo\+PT are the mean brightness temprature, linear and quadratic biases, clustering and shot noise contributions of 7 emission spectral lines, depending on the switch that you set in the ini file. The computation of these functions are performed within \mbox{\hyperlink{main_8c}{main.\+c}} module. An example of the ini file is provided (LCDM.\+ini). If you want to call any of the functions of lim\+Halo\+PT, apart from those called by defacult, you neeed to add the function call to \mbox{\hyperlink{main_8c}{main.\+c}}, recompile the code by first cleaning the previous build using \char`\"{}make clean\char`\"{} and building the package again with \char`\"{}make\char`\"{}.

Example\+: Lets say you want to compute the mean brightness temprature, linear and quadratic biases for one or multiple emission lines, as a function of wavenumber at several redshifts. In the .ini file, you should set the switch \char`\"{}switch\+\_\+\+Tbar\char`\"{} to be equal to \char`\"{}\+Tbar\char`\"{}, and the switches of shot and power spectra blank, i.\+e. \char`\"{}switch\+\_\+\+HMshot = \char`\"{} and \char`\"{}switch\+\_\+\+HMshot = \char`\"{}. The relavent functions that are called within \mbox{\hyperlink{main_8c}{main.\+c}} are \mbox{\hyperlink{ps__line__hm_8c_ab3acf266df779fd7b847b2ca641efa01}{PS\+\_\+line\+\_\+\+HM()}} and \mbox{\hyperlink{line__ingredients_8c_a3a13aa566fb639abeb29eae43e5fcfa8}{line\+\_\+bias()}}. For this function call, first two arrays for values of redshifts and wavenumbers for which the power spectrum is computed are created. the computed values for the three quantities is saved by default in an output file saved in \char`\"{}\+Output\char`\"{} directory. The number of emission lines to be included in the computation is set with \char`\"{}nlines\char`\"{} variable in the LCDM.\+ini file, while the name of the line is passed with line1, line2, ... variables. T The first argument of PS\+\_\+line\+\_\+\+HM, is the cosmology structure needed for performing any calculation in the code. See \mbox{\hyperlink{cosmology_8c}{cosmology.\+c}} module for more details. The LCDM.\+ini file contains description of parmaeters that should be set in the .ini file.

So here is how ythe \mbox{\hyperlink{ps__line__hm_8c_ab3acf266df779fd7b847b2ca641efa01}{PS\+\_\+line\+\_\+\+HM()}} function is called within \mbox{\hyperlink{main_8c_a0ddf1224851353fc92bfbff6f499fa97}{main()}}\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{int nz\_mean     = gb.mean\_nz;}
\DoxyCodeLine{double *z\_mean  = init\_1Darray(nz\_mean,0.0,gb.mean\_zmax);}
\DoxyCodeLine{}
\DoxyCodeLine{double lbias\_arr[2];}
\DoxyCodeLine{double b1   = 0.;}
\DoxyCodeLine{double b2   = 0.;}
\DoxyCodeLine{double Tbar = 0.;}
\DoxyCodeLine{}
\DoxyCodeLine{FILE *fp1;}
\DoxyCodeLine{char filename1[FILENAME\_MAX];}
\DoxyCodeLine{}
\DoxyCodeLine{for(int i=0;i<nlines;i++)\{}
\DoxyCodeLine{      sprintf(filename1,"{}\%s/Tbar\_J\%d.txt"{}, gb.output\_dir, JJ[i]);}
\DoxyCodeLine{      fp1    = fopen(filename1, "{}ab"{});}
\DoxyCodeLine{      fprintf(fp1,"{}\%s \%s \%s \%s \%s \(\backslash\)n"{},"{}\#"{}, "{}z"{}, "{}b1"{}, "{}b2"{}, "{}Tbar"{});}
\DoxyCodeLine{      for(int j=0;j<nz\_mean;j++)\{}
\DoxyCodeLine{            Tbar = Tbar\_line(\&Cx\_ref, i, z\_mean[j]);}
\DoxyCodeLine{            line\_bias(Cx\_ref.Lines[i],z\_mean[j],lbias\_arr);}
\DoxyCodeLine{            b1   = lbias\_arr[0];}
\DoxyCodeLine{            b2   = lbias\_arr[1];}
\DoxyCodeLine{            fprintf(fp1,"{}\%12.6e \%12.6e \%12.6e \%12.6e \(\backslash\)n"{},z\_mean[j], b1, b2, Tbar); }
\DoxyCodeLine{      \}}
\DoxyCodeLine{      fclose(fp1);}
\DoxyCodeLine{\}}
\DoxyCodeLine{free(z\_mean);}

\end{DoxyCode}


By default, in addition to having the output in \mbox{\hyperlink{main_8c_a0ddf1224851353fc92bfbff6f499fa97}{main()}} function for mean brightness temprature, biases, shot and clustering components of power spectrum, when computing the clustering and shot powers, individual loop contributions (in the former) and individual beyon-\/\+Possion contribution to the shot (in the latter), are also saved to output files which are stored in \char`\"{}\+Output\char`\"{} directory.

In addition to using lim\+Halo\+PT through \char`\"{}main.\+c\char`\"{} module which calls three specific functions, lim\+Halp\+PT can be exported as an external library to any other C code. For example if you would like to call the function that computes the halo mass function for a given theoretical model, once the liblim\+Halo\+PT.\+a library is linked to, the relevent function can be accessed from an external C code. ~\newline
 ~\hypertarget{index_autotoc_md7}{}\doxysubsubsection{Testing}\label{index_autotoc_md7}
\char`\"{}\+Test\char`\"{} directory includes an automated test for the three main functions of lim\+Halo\+PT, which are called within \mbox{\hyperlink{main_8c}{main.\+c}} module. These tests are designed to test functionality of the code. Therefore, by default the parameters of the .ini file are set to values that allow to run the code fast. Note that these values should not be used when running the analysis, since the output would not have the precisioon needed for cosmological analysis.

Having compiled lim\+Halo\+PT package, and created the \char`\"{}liblim\+Halo\+PT.\+a\char`\"{} library, to run the test, switch to \char`\"{}\+Test\char`\"{} subdirectory. You have to first do \char`\"{}make\char`\"{}, and then you can run the code by typying \char`\"{}./test test\+\_\+\+LCDM.\+ini. Upon completion, the output files are stored in \char`\"{}Test/\+Output\char`\"{} directory.   \+Note that the test.\+c also can surve as an example of how you can link your code to liblim\+Halo\+PT.\+a library.  $<$br$>$ ~   @subsection autotoc\+\_\+md8 Attribution \+You can use this package freely, provided that in your publication you cite the following paper\+: Moradinezhad, Nikakhtar, Keating, Castorina\+: $<$a href=\char`\"{}\href{https://arxiv.org/abs/2111.03717}{\texttt{ https\+://arxiv.\+org/abs/2111.\+03717}}\char`\"{} $>$ar\+Xiv\+:2111.\+03717$<$/a$>$. Furthermore, since lim\+Halo\+PT relies on CLASS Boltzman code, you should also cite at least this paper $<$a href=\char`\"{}\href{https://arxiv.org/abs/1104.2933}{\texttt{ https\+://arxiv.\+org/abs/1104.\+2933}}\char`\"{} $>$arxiv\+:1104.\+2933$<$/a$>$ as required by CLASS developers.  $<$br$>$ ~   @subsection autotoc\+\_\+md9 License $<$a href=\char`\"{}\href{https://opensource.org/licenses/MIT}{\texttt{ https\+://opensource.\+org/licenses/\+MIT}}\char`\"{} $>$$<$img src=\char`\"{}\href{https://img.shields.io/badge/License-MIT-blue.svg}{\texttt{ https\+://img.\+shields.\+io/badge/\+License-\/\+MIT-\/blue.\+svg}}\char`\"{} alt=\char`\"{}License\+: MIT\char`\"{}/$>$$<$/a$>$  $<$br$>$ \+Copyright 2021 Azadeh Moradinezhad Dizgah.$<$br$>$ lim\+Halo\+PT is free software made available under the MIT License. For details see the $<$a href=\char`\"{}\href{https://github.com/amoradinejad/limHaloPT/blob/d40a4a75188ae70f56ed76236d1fd9ee1aae312d/LICENSE}{\texttt{ https\+://github.\+com/amoradinejad/lim\+Halo\+PT/blob/d40a4a75188ae70f56ed76236d1fd9ee1aae312d/\+LICENSE}}"{} \texorpdfstring{$>$}{>}LICENSE file. ~\newline
 ~\hypertarget{index_autotoc_md10}{}\doxysubsubsection{Contributing}\label{index_autotoc_md10}
To contribute, create a fork on github, make changes and commits, and submit a pull request on github. If you found any issues with the code, please get in touch by posting an issue on this github repository. ~\newline
 ~ 